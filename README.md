# 前言
本文档介绍如何使用整个智能音乐系统,主要包括本地歌手音频数据的构造和GUI界面的使用。若要了解本软件的系统框架，可以查看我画的关于整个智能音乐系统的uml建模图，该图完整地描述了各个模块的结构和组成关系。

# 环境
 - python 3.7
 - pytorch 1.10.2
 - PyQt5
 - cloudmusic
 - pyaudio
 - cv2
 - [需安装ffmpeg](https://www.bilibili.com/read/cv15392053)

**注意：** [安装pyaudio失败解决办法](https://blog.csdn.net/weixin_42376686/article/details/120754389)
# 建立数据库
首先构造本地歌手音频数据库，目录名为audio_db，子目录格式为`audio_db/singer_name/{1.wav,2.wav......}`；即只需在audio_db根目录下创建歌手子目录（以歌手名称命名），再在歌手子目录中添加歌手的**wav**格式音频即可。这就完成了音频数据库的构造。

然后是本地音频特征数据库的构造，在完成本地歌手音频数据库的构造后，运行`make_local_database.py`文件便可自动完成本地音频特征数据库的构造，且保存于`audio_data.txt`。

# 系统使用
运行`main.py`文件便可自动启动**智能音乐系统**；

共有两大功能模块位于主界面的左侧，***分类歌单*** 和***声纹识别*** ；具体使用方法请将鼠标指针停留在对应的按钮图标上即可给出hint。

这里需要**提醒：**

1. 在使用声纹识别模块时，请先选择正确的音频文件路径或者录制好自己的音频后，再进行声纹识别。声纹识别后再点击搜索按钮，等待片刻将给出识别结果歌手的信息以及相关的热门歌曲。

2. *格式转化* 标签显示为 **√** 的需要时间较长，请耐心等待。

3. 有些歌曲双击播放时可能出现bug（起始时间和终止时间均为00:00），这时请重新选择一首歌曲进行播放。

4. 系统默认每首歌曲只▶一次。

5. 关闭系统请点击左边的**关闭按钮×** 以释放临时文件。

6. 如果分类歌单歌曲/歌手热门歌单歌曲太少，请重复点击对应按钮来刷新。

7. 下载歌曲保存在根目录的`cloudmusic`目录下。

8. 请将鼠标指针悬停于按钮上以查看hint。

# 注意关于爬虫库
本系统在调用cloudmusic等库爬取歌曲时，会出现网络繁忙的情况，但他库本身没有进行特判，因此会报一个`KeyError: 'songs'`的错误；**解决办法：** 跳转到`creatObj.py`函数，将该函数第一个for循环之前的代码改为：
```
api = sessions.api.Api()
musicUrl = api.get_song_url(dict(ID = ids, level = level))['data']
musicInfo = api.get_song_detail(dict(ID=ids))
if musicInfo.get('code', -1) == -460:
    # 判断是否网络繁忙
    return []
musicInfo = musicInfo['songs']
musicOtp = []
```

# 更新日志

1. *6-17日* 初步完成整个系统，实现了基于爬虫、声纹识别、分类歌单功能的智能音乐系统song for you;
2. *6-25日* 更新如下功能：①添加上一首、下一首功能；②添加播放模式即：单曲、顺序、随机播放；③对于爬取格式为m4a的情况，将m4a转化为mp3格式进行播放。
3. *6-26日* ①更新本地歌单的功能，对整个播放媒体流的逻辑进行重新编写。支持选择本地路径进行音乐的播放，对于本地暂时只支持播放音乐而不支持其他method。②新增按钮点击音效；创建otherFiles以放置音效、音频特征数据、icon等附加文件.